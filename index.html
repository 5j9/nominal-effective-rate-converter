<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Interest Rate Converter (Concise)</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
    <style>
        /* BASE STYLES & TAILWIND EMULATION */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        body {
            font-family: sans-serif;
            background-color: #f3f4f6;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 16px;
            margin: 0;
        }

        .main-container {
            background-color: #fff;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 750px;
            /* Adjusted max-width for 3 columns */
            margin: 32px auto;
        }

        .text-center {
            text-align: center;
        }

        .mb-6 {
            margin-bottom: 24px;
        }

        .text-3xl {
            font-size: 1.875rem;
        }

        .font-bold {
            font-weight: 700;
        }

        .text-gray-800 {
            color: #1f2937;
        }

        .text-gray-500 {
            color: #6b7280;
        }

        .mt-2 {
            margin-top: 8px;
        }

        .mb-4 {
            margin-bottom: 16px;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .font-semibold {
            font-weight: 600;
        }

        .text-gray-700 {
            color: #374151;
        }

        .space-y-4>div+div {
            margin-top: 16px;
        }

        .block {
            display: block;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .w-full {
            width: 100%;
        }

        .px-4 {
            padding-left: 16px;
            padding-right: 16px;
        }

        .py-2 {
            padding-top: 8px;
            padding-bottom: 8px;
        }

        .border {
            border-width: 1px;
            border-style: solid;
        }

        .border-gray-300 {
            border-color: #d1d5db;
        }

        .rounded-lg {
            border-radius: 8px;
        }

        .focus\:outline-none:focus {
            outline: none;
        }

        .focus\:ring-2:focus {
            box-shadow: 0 0 0 2px var(--tw-ring-color);
            z-index: 10;
            position: relative;
        }

        .focus\:ring-indigo-500:focus {
            --tw-ring-color: #6366f1;
        }

        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-1 {
            flex: 1 1 0%;
        }

        .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* 3-COLUMN GRID STYLES */
        .grid-container {
            display: grid;
            /* 3 Columns: Period, Nominal, Effective Period */
            grid-template-columns: 1fr minmax(0, 1.2fr) minmax(0, 1.2fr);
            gap: 1px;
            background-color: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .grid-header,
        .grid-cell {
            padding: 12px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.875rem;
        }

        .grid-header {
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
        }

        .grid-row-label {
            background-color: #e0e7ff;
            color: #4f46e5;
            font-weight: 600;
            justify-content: flex-start;
            padding-left: 20px;
        }

        .grid-cell input {
            width: 100%;
            text-align: right;
            border: none;
            padding: 8px;
            background-color: transparent;
            font-weight: 500;
        }

        .future-value-section {
            display: flex;
            gap: 24px;
            align-items: flex-end;
        }

        .future-value-result {
            flex: 1;
            padding: 16px;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
        }

        .time-horizon-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .time-horizon-group label {
            display: inline-flex;
            align-items: center;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="main-container">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-gray-800">Universal Interest Rate Converter</h1>
            <p class="text-gray-500 mt-2">Enter a value in any field to calculate all others.</p>
        </div>

        <div class="grid-container" id="rateMatrix">
            <div class="grid-header" style="background-color: #6366f1;">Compounding Period</div>
            <div class="grid-header">Stated Annual Rate (Nominal, %)</div>
            <div class="grid-header">Effective Period Rate (Daily/Monthly/etc., %)</div>

            <div class="grid-row-label">Daily</div>
            <div class="grid-cell"><input type="number" id="nominal_Daily" data-periods="365"></div>
            <div class="grid-cell"><input type="number" id="effective_period_Daily" data-periods="365"></div>

            <div class="grid-row-label">Monthly</div>
            <div class="grid-cell"><input type="number" id="nominal_Monthly" data-periods="12"></div>
            <div class="grid-cell"><input type="number" id="effective_period_Monthly" data-periods="12"></div>

            <div class="grid-row-label">Quarterly</div>
            <div class="grid-cell"><input type="number" id="nominal_Quarterly" data-periods="4"></div>
            <div class="grid-cell"><input type="number" id="effective_period_Quarterly" data-periods="4"></div>

            <div class="grid-row-label">Annual</div>
            <div class="grid-cell"><input type="number" id="nominal_Annual" data-periods="1"></div>
            <div class="grid-cell"><input type="number" id="effective_period_Annual" data-periods="1"></div>

        </div>

        <h2 class="text-xl font-semibold text-gray-700 mb-4">Calculate Future Value (Based on Effective Annual Rate)
        </h2>
        <div class="future-value-section">
            <div class="flex-1 space-y-4">
                <div>
                    <label for="principalAmount" class="block text-sm font-medium text-gray-700 mb-1">Principal
                        Amount ($)</label>
                    <input type="number" id="principalAmount" value="1000"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>
                <div>
                    <label for="timeHorizon" class="block text-sm font-medium text-gray-700 mb-1">Time Horizon</label>
                    <div class="time-horizon-group">
                        <input type="number" id="timeValue" value="1"
                            class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <div class="flex space-x-3 text-sm">
                            <label>
                                <input type="radio" name="timeUnit" value="days" class="mr-1" id="timeUnitDays">Days
                            </label>
                            <label>
                                <input type="radio" name="timeUnit" value="months" class="mr-1"
                                    id="timeUnitMonths">Months
                            </label>
                            <label>
                                <input type="radio" name="timeUnit" value="years" class="mr-1" id="timeUnitYears"
                                    checked>Years
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="future-value-result">
                <p class="text-sm font-medium text-gray-700">Future Value:</p>
                <p class="text-3xl font-bold text-gray-800"><span id="futureValue">--</span></p>
            </div>
        </div>

    </div>

    <script>
        const MAPPING = {
            'Daily': 365,
            'Monthly': 12,
            'Quarterly': 4,
            'Annual': 1
        };
        const MATRIX_INPUTS = {};
        const PERIOD_NAMES = ['Daily', 'Monthly', 'Quarterly', 'Annual'];
        // All possible input types
        const RATE_TYPES = ['nominal', 'effective_period'];

        const principalAmountInput = document.getElementById('principalAmount');
        const timeValueInput = document.getElementById('timeValue');
        const timeUnitInputs = document.querySelectorAll('input[name="timeUnit"]');
        const futureValueSpan = document.getElementById('futureValue');

        let activeInputId = null; // Tracks the ID of the field last modified

        // --- Initialization and Setup ---

        // 1. Map all inputs and attach event listeners
        PERIOD_NAMES.forEach(period => {
            RATE_TYPES.forEach(type => {
                const id = `${type}_${period}`;
                const element = document.getElementById(id);
                if (element) {
                    MATRIX_INPUTS[id] = element;
                    element.addEventListener('input', (event) => {
                        // Clear the content of all other fields before calculation
                        clearAllButOne(id);
                        activeInputId = id;
                        updateAllRates(id);
                    });
                }
            });
        });

        // 2. Setup Future Value listeners
        principalAmountInput.addEventListener('input', calculateFutureValue);
        timeValueInput.addEventListener('input', calculateFutureValue);
        timeUnitInputs.forEach(input => {
            input.addEventListener('change', calculateFutureValue);
        });

        // --- Core Conversion Functions ---

        /**
         * Clears all fields in the matrix except the one being edited.
         * @param {string} excludeId - The ID of the input field to keep.
         */
        function clearAllButOne(excludeId) {
            for (const id in MATRIX_INPUTS) {
                if (id !== excludeId) {
                    MATRIX_INPUTS[id].value = '';
                }
            }
        }

        /**
         * Converts the single input rate into the Effective Annual Rate (EAR).
         * @param {string} inputId - The ID of the field that was just edited.
         * @returns {number | null} The Effective Annual Rate (EAR) as a decimal, or null if input is invalid.
         */
        function calculateEffectiveAnnualRate(inputId) {
            const inputElement = MATRIX_INPUTS[inputId];
            if (!inputElement) return null;

            const inputValue = parseFloat(inputElement.value);
            if (isNaN(inputValue) || inputValue < 0) return null;

            const rate = inputValue / 100;
            const parts = inputId.split('_');

            // Determine the base type and period from the ID
            let type = parts[0];
            let period = parts[parts.length - 1];

            // Handle the composite type name
            if (parts[1] === 'period') type = 'effective_period';

            const m = MAPPING[period]; // Compounding periods per year

            if (type === 'effective_period') {
                // The input is the Effective Rate for the compounding period (r_period).
                // EAR = (1 + r_period)^m - 1
                return Math.pow(1 + rate, m) - 1;
            } else { // type === 'nominal' (Stated Annual Rate for Period m)
                // The input is the Stated Annual Rate compounded m times.
                // EAR = (1 + Nominal_Annual/m)^m - 1
                return Math.pow(1 + rate / m, m) - 1;
            }
        }


        /**
         * Updates all other fields in the matrix based on the calculated EAR.
         * @param {number} earDecimal - The Effective Annual Rate as a decimal.
         * @param {string} excludeId - The ID of the field to skip updating.
         */
        function updateMatrix(earDecimal, excludeId) {

            // 1. Iterate through all targets and convert from EAR.
            for (const id in MATRIX_INPUTS) {
                if (id === excludeId) continue;

                const parts = id.split('_');
                let type = parts[0];
                let period = parts[parts.length - 1];

                // Handle the composite type name
                if (parts[1] === 'period') type = 'effective_period';

                const m = MAPPING[period];

                let result; // The final rate value in percent

                if (type === 'effective_period') {
                    // Target: Effective Period Rate (r_period)
                    // Formula: r_period = (1 + EAR)^(1/m) - 1
                    result = (Math.pow(1 + earDecimal, 1 / m) - 1) * 100;

                } else { // type === 'nominal' (Stated Annual Rate for Period m)
                    // Target: Stated Annual Rate (Nominal_m)
                    // Formula: Nominal_m = m * [(1 + EAR)^(1/m) - 1] 
                    const effectivePeriodRate = Math.pow(1 + earDecimal, 1 / m) - 1;
                    result = (effectivePeriodRate * m) * 100;
                }

                MATRIX_INPUTS[id].value = result.toFixed(6); // Use 6 decimal places for precision
            }
        }

        /**
         * Main orchestration function.
         * @param {string} inputId - The ID of the field that was just edited.
         */
        function updateAllRates(inputId) {
            const ear = calculateEffectiveAnnualRate(inputId);

            if (ear !== null) {
                updateMatrix(ear, inputId);
            } else {
                // If the input is invalid (cleared or non-positive), clear the rest of the matrix
                clearAllButOne(inputId);
            }

            // Recalculate Future Value regardless of rate validity (it handles null/zero rates)
            calculateFutureValue();
        }

        // --- Future Value Calculation ---

        function calculateFutureValue() {
            const principal = parseFloat(principalAmountInput.value || 1000); // Default to 1000
            const timeValue = parseFloat(timeValueInput.value || 1);
            let timeUnit = 'years';

            timeUnitInputs.forEach(input => {
                if (input.checked) {
                    timeUnit = input.value;
                }
            });

            // Determine the active EAR from the last input field, or default to 0.
            let earDecimal = 0;
            if (activeInputId) {
                const calculatedEar = calculateEffectiveAnnualRate(activeInputId);
                if (calculatedEar !== null) {
                    earDecimal = calculatedEar;
                }
            }

            if (isNaN(principal) || principal < 0 || isNaN(timeValue) || timeValue < 0) {
                futureValueSpan.textContent = "Invalid Input";
                return;
            }

            // Convert time to years
            let timeInYears;
            switch (timeUnit) {
                case 'days':
                    timeInYears = timeValue / 365;
                    break;
                case 'months':
                    timeInYears = timeValue / 12;
                    break;
                case 'years':
                default:
                    timeInYears = timeValue;
                    break;
            }

            // Formula: FV = PV * (1 + EAR)^t
            const futureValue = principal * Math.pow(1 + earDecimal, timeInYears);

            futureValueSpan.textContent = '$' + futureValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Set initial default values and run calculation once
        document.getElementById('principalAmount').value = 1000;
        document.getElementById('timeValue').value = 1;
        document.getElementById('timeUnitYears').checked = true;

        // Initialize with a default rate (e.g., 5% Annual EAR)
        const initialRateId = 'nominal_Annual';
        document.getElementById(initialRateId).value = 5;
        activeInputId = initialRateId;
        updateAllRates(initialRateId); 
    </script>
</body>

</html>
